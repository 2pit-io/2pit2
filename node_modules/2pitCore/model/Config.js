const loadJsonFile = require('load-json-file');

/**
 Load the application config and the module config for each module listed in the 'module' entry 
 */
exports.loadConfig = function() {

  var applicationConfig = loadJsonFile.sync('config/applicationConfig.json');

  // Construct a "controllers" config entry at the application level consolidating the controllers defined in each module
  
  var config = [];
  Object.keys(applicationConfig).forEach(function(key) {
    config[key] = applicationConfig[key];
  });
  
  config['controllers'] = [];
  Object.keys(applicationConfig.modules).forEach(function(moduleId) {
    var moduleConfig = loadJsonFile.sync('node_modules/' + moduleId + '/moduleConfig.json');

    Object.keys(moduleConfig.controllers).forEach(function(controllerId) {
      moduleConfig.controllers[controllerId].module = applicationConfig.modules[moduleId];
      config.controllers[controllerId] = moduleConfig.controllers[controllerId];
    });
  });

  return config;
}
